<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Big Data and Cloud Computing</title>
  <meta name="description" content="Course materials for Big Data and Cloud Computing">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Big Data and Cloud Computing" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="figures/cover_image.png" />
  <meta property="og:description" content="Course materials for Big Data and Cloud Computing" />
  <meta name="github-repo" content="bioinformatics-training/big-data-cloud" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Big Data and Cloud Computing" />
  
  <meta name="twitter:description" content="Course materials for Big Data and Cloud Computing" />
  <meta name="twitter:image" content="figures/cover_image.png" />

<meta name="author" content="Sudhakaran Prabakaran and Matt Wayland">


<meta name="date" content="2018-05-30">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="storage.html">
<link rel="next" href="formations.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />










<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">An Introduction to Machine Learning</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> About the course</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#overview"><i class="fa fa-check"></i><b>1.1</b> Overview</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#registration"><i class="fa fa-check"></i><b>1.2</b> Registration</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#prerequisites"><i class="fa fa-check"></i><b>1.3</b> Prerequisites</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#github"><i class="fa fa-check"></i><b>1.4</b> Github</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i><b>1.5</b> License</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#contact"><i class="fa fa-check"></i><b>1.6</b> Contact</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#colophon"><i class="fa fa-check"></i><b>1.7</b> Colophon</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="rosetta-hub.html"><a href="rosetta-hub.html"><i class="fa fa-check"></i><b>2</b> Introduction to RosettaHUB</a><ul>
<li class="chapter" data-level="2.1" data-path="rosetta-hub.html"><a href="rosetta-hub.html#features"><i class="fa fa-check"></i><b>2.1</b> Features</a></li>
<li class="chapter" data-level="2.2" data-path="rosetta-hub.html"><a href="rosetta-hub.html#your-account"><i class="fa fa-check"></i><b>2.2</b> Your account</a></li>
<li class="chapter" data-level="2.3" data-path="rosetta-hub.html"><a href="rosetta-hub.html#navigating-the-platform"><i class="fa fa-check"></i><b>2.3</b> Navigating the platform</a></li>
<li class="chapter" data-level="2.4" data-path="rosetta-hub.html"><a href="rosetta-hub.html#aws"><i class="fa fa-check"></i><b>2.4</b> AWS</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="containers.html"><a href="containers.html"><i class="fa fa-check"></i><b>3</b> Images and containers</a><ul>
<li class="chapter" data-level="3.1" data-path="containers.html"><a href="containers.html#definitions"><i class="fa fa-check"></i><b>3.1</b> Definitions</a></li>
<li class="chapter" data-level="3.2" data-path="containers.html"><a href="containers.html#images-on-rosettahub"><i class="fa fa-check"></i><b>3.2</b> Images on RosettaHUB</a></li>
<li class="chapter" data-level="3.3" data-path="containers.html"><a href="containers.html#launch-a-container"><i class="fa fa-check"></i><b>3.3</b> Launch a container</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="storage.html"><a href="storage.html"><i class="fa fa-check"></i><b>4</b> Storage</a><ul>
<li class="chapter" data-level="4.1" data-path="storage.html"><a href="storage.html#create-an-s3-bucket"><i class="fa fa-check"></i><b>4.1</b> Create an S3 bucket</a></li>
<li class="chapter" data-level="4.2" data-path="storage.html"><a href="storage.html#identity-and-access-management-iam"><i class="fa fa-check"></i><b>4.2</b> Identity and Access Management (IAM)</a></li>
<li class="chapter" data-level="4.3" data-path="storage.html"><a href="storage.html#aws-command-line-tools"><i class="fa fa-check"></i><b>4.3</b> AWS command line tools</a><ul>
<li class="chapter" data-level="4.3.1" data-path="storage.html"><a href="storage.html#installation-of-aws-cli"><i class="fa fa-check"></i><b>4.3.1</b> Installation of AWS CLI</a></li>
<li class="chapter" data-level="4.3.2" data-path="storage.html"><a href="storage.html#configuration-of-the-aws-cli"><i class="fa fa-check"></i><b>4.3.2</b> Configuration of the AWS CLI</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="customizing-images.html"><a href="customizing-images.html"><i class="fa fa-check"></i><b>5</b> Customizing images</a><ul>
<li class="chapter" data-level="5.1" data-path="customizing-images.html"><a href="customizing-images.html#introduction"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="customizing-images.html"><a href="customizing-images.html#launch-machine"><i class="fa fa-check"></i><b>5.2</b> Launch machine</a></li>
<li class="chapter" data-level="5.3" data-path="customizing-images.html"><a href="customizing-images.html#connect-to-machine"><i class="fa fa-check"></i><b>5.3</b> Connect to machine</a></li>
<li class="chapter" data-level="5.4" data-path="customizing-images.html"><a href="customizing-images.html#mount-s3-storage"><i class="fa fa-check"></i><b>5.4</b> Mount S3 storage</a></li>
<li class="chapter" data-level="5.5" data-path="customizing-images.html"><a href="customizing-images.html#configure-server-to-send-e-mail"><i class="fa fa-check"></i><b>5.5</b> Configure server to send e-mail</a></li>
<li class="chapter" data-level="5.6" data-path="customizing-images.html"><a href="customizing-images.html#install-r"><i class="fa fa-check"></i><b>5.6</b> Install R</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="formations.html"><a href="formations.html"><i class="fa fa-check"></i><b>6</b> Formations</a></li>
<li class="chapter" data-level="7" data-path="run-analysis.html"><a href="run-analysis.html"><i class="fa fa-check"></i><b>7</b> Run data analysis</a></li>
<li class="chapter" data-level="8" data-path="collaboration.html"><a href="collaboration.html"><i class="fa fa-check"></i><b>8</b> Collaboration</a><ul>
<li class="chapter" data-level="8.1" data-path="collaboration.html"><a href="collaboration.html#real-time-collaboration"><i class="fa fa-check"></i><b>8.1</b> Real time collaboration</a></li>
<li class="chapter" data-level="8.2" data-path="collaboration.html"><a href="collaboration.html#sharing-images-and-formations"><i class="fa fa-check"></i><b>8.2</b> Sharing images and formations</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="resources.html"><a href="resources.html"><i class="fa fa-check"></i><b>9</b> Resources</a><ul>
<li class="chapter" data-level="9.1" data-path="resources.html"><a href="resources.html#rosetta-hub-documentation"><i class="fa fa-check"></i><b>9.1</b> Rosetta Hub Documentation</a></li>
<li class="chapter" data-level="9.2" data-path="resources.html"><a href="resources.html#general-data-protection-regulation-gdpr"><i class="fa fa-check"></i><b>9.2</b> General Data Protection Regulation (GDPR)</a><ul>
<li class="chapter" data-level="9.2.1" data-path="resources.html"><a href="resources.html#guidance-from-the-university-of-cambridge"><i class="fa fa-check"></i><b>9.2.1</b> Guidance from the University of Cambridge</a></li>
<li class="chapter" data-level="9.2.2" data-path="resources.html"><a href="resources.html#aws-gdpr-center"><i class="fa fa-check"></i><b>9.2.2</b> AWS GDPR Center</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="resources.html"><a href="resources.html#docker-glossary"><i class="fa fa-check"></i><b>9.3</b> Docker glossary</a></li>
<li class="chapter" data-level="9.4" data-path="resources.html"><a href="resources.html#grants-available-from-service-providers"><i class="fa fa-check"></i><b>9.4</b> Grants available from service providers</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Big Data and Cloud Computing</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="customizing-images" class="section level1">
<h1><span class="header-section-number">5</span> Customizing images</h1>
<!--
1. launch ubuntu server (note on setting max spot price high; also increase disk size)
2. access ubuntu server
3. copy files using scp
4. setup ssmtp for e-mail alerts
5. install R
  - check version available in ubuntu repository
  - build R from source and install
6. install caret and any other R packages needed (doMC, RColorBrewer)
7. save running container as a new image
8. shutdown
9. relaunch and test everything is working


-->
<div id="introduction" class="section level2">
<h2><span class="header-section-number">5.1</span> Introduction</h2>
<p>We can customize any of the managed or semi-managed images provided on RosettaHUB, by installing additional software or making other configuration changes. The process is as follows:</p>
<ol style="list-style-type: decimal">
<li>launch a RosettaHUB machine</li>
<li>install additional software and/or make configuration changes</li>
<li>create a new image from the modified machine</li>
</ol>
<p>In Docker terminology, we add a <a href="https://docs.docker.com/glossary/?term=layer">layer</a> to the base image.</p>
<p>For some projects we do not want the overhead of a graphical user interface and do not require all of the tools provided by the managed</p>
<p>To create a derived managed image, users have to launch a RosettaHUB machine then create an image from that machine on RosettaHUB. Managed images are configured with Docker containers. Docker containers contain applications for data science such as Pyhton, R, Rstudio, Scala, Sql and notebooks such as Jupyter and Zeppelin.</p>
<p>We can create derived images from any of these baseline images.</p>
<p>Explain example</p>
</div>
<div id="launch-machine" class="section level2">
<h2><span class="header-section-number">5.2</span> Launch machine</h2>
<p>On Federation Console, go to Images section where you will see the following list:</p>
<p>Right click on Ubuntu Server 16.04 LTS and select ‘Launch’ from the context menu.</p>
<div class="figure" style="text-align: center"><span id="fig:customManagedImages"></span>
<img src="images/image_list_icons.png" alt="Managed images available" width="100%" />
<p class="caption">
Figure 5.1: Managed images available
</p>
</div>
<div class="figure" style="text-align: center"><span id="fig:customLaunchUbuntuServer"></span>
<img src="images/launch_ubuntu_server_2.png" alt="Launch ubuntu server" width="100%" />
<p class="caption">
Figure 5.2: Launch ubuntu server
</p>
</div>
<div class="figure" style="text-align: center"><span id="fig:customSessionsFormationsUbuntuServerBase"></span>
<img src="images/sessions_formations_ubuntu_server_base.png" alt="Ubuntu server container is listed under formations and sessions" width="100%" />
<p class="caption">
Figure 5.3: Ubuntu server container is listed under formations and sessions
</p>
</div>
</div>
<div id="connect-to-machine" class="section level2">
<h2><span class="header-section-number">5.3</span> Connect to machine</h2>
<div class="figure" style="text-align: center"><span id="fig:customUbuntuServerBaseContextMenu"></span>
<img src="images/ubuntu_server_base_session_context_menu.png" alt="Context menu for ubuntu server container" width="50%" />
<p class="caption">
Figure 5.4: Context menu for ubuntu server container
</p>
</div>
<div class="figure" style="text-align: center"><span id="fig:customUbuntuServerBaseConnectivityInformation"></span>
<img src="images/ubuntu_server_base_connectivity_information.png" alt="Connectivity information for ubuntu server container" width="100%" />
<p class="caption">
Figure 5.5: Connectivity information for ubuntu server container
</p>
</div>
<pre><code>ls -la private-keys-m-e1f0bf55-815b-439b-afae-a157d59facbe-0.pem 
-rw-rw-rw-@ 1 matt  staff  1674 29 May 20:37 private-keys-m-e1f0bf55-815b-439b-afae-a157d59facbe-0.pem</code></pre>
<pre><code>chmod 600 private-keys-m-e1f0bf55-815b-439b-afae-a157d59facbe-0.pem</code></pre>
<pre><code>ssh ubuntu@vm-34-245-226-49.rosettavm.com -i private-keys-m-e1f0bf55-815b-439b-afae-a157d59facbe-0.pem</code></pre>
</div>
<div id="mount-s3-storage" class="section level2">
<h2><span class="header-section-number">5.4</span> Mount S3 storage</h2>
<p>We will use the tool <a href="https://github.com/s3fs-fuse/s3fs-fuse">s3fs</a>.</p>
<p>Install s3fs from ubuntu repository</p>
<pre><code>sudo apt-get install s3fs</code></pre>
<p>Find the <strong>Access Key ID</strong> and <strong>Secret Access Key</strong> for your default iamuser. They will appear like this: <strong>Access Key ID:</strong> <em>X</em> <strong>Secret Access Key:</strong> <em>X</em></p>
<p>Create the /etc/passwd-s3fs file</p>
<pre><code>sudo echo ACCESS_KEY_ID:Secret_Access_KEY_ID &gt; /etc/passwd-s3fs</code></pre>
<p>Save file, then set appropriate permissions</p>
<pre><code>sudo chmod 640 /etc/passwd-s3fs</code></pre>
<p>Create a mount point and mount S3 bucket</p>
<pre><code>sudo mkdir -p /mnt/s3
sudo s3fs com-rosettahub-default-bioinfo1.cam /mnt/s3 -o passwd_file=/etc/passwd-s3fs</code></pre>
<p>unmount</p>
<pre><code>sudo umount /mnt/s3</code></pre>
<p>edit /etc/fstab</p>
<pre><code>LABEL=cloudimg-rootfs   /    ext4   defaults,discard    0 0
s3fs#com-rosettahub-default-bioinfo1.cam /mnt/s3 fuse _netdev,allow_other 0 0</code></pre>
</div>
<div id="configure-server-to-send-e-mail" class="section level2">
<h2><span class="header-section-number">5.5</span> Configure server to send e-mail</h2>
<p>secure simple mail transfer protocol</p>
<p>Update local package cache</p>
<pre><code>sudo apt-get update</code></pre>
<p>Install the ssmtp package</p>
<pre><code>sudo apt-get install ssmtp</code></pre>
<p>Setup ssmtp by editing the configuration file</p>
<pre><code>sudo nano /etc/ssmtp/ssmtp.conf</code></pre>
<p>Adjust and add as necessary to match the following parameters Change “MyEmailAddress” and “MyPassword” to your own.</p>
<pre><code># Config file for sSMTP sendmail
#
# The person who gets all mail for userids &lt; 1000
# Make this empty to disable rewriting.
#root=postmaster
root=MyEmailAddress@gmail.com

# The place where the mail goes. The actual machine name is required no
# MX records are consulted. Commonly mailhosts are named mail.domain.com
#mailhub=mail
mailhub=smtp.gmail.com:587

AuthUser=MyEmailAddress@gmail.com
AuthPass=MyPassword
UseTLS=YES
UseSTARTTLS=YES

# Where will the mail seem to come from?
#rewriteDomain=
rewriteDomain=gmail.com

# The full hostname
#hostname=MyMediaServer.home
hostname=MyMediaServer.home

# Are users allowed to set their own From: address?
# YES - Allow the user to specify their own From: address
# NO - Use the system generated From: address
FromLineOverride=YES</code></pre>
<p>Create aliases for local usernames (optional) by editing the /etc/ssmtp/revaliases file</p>
<pre><code>sudo nano /etc/ssmtp/revaliases</code></pre>
<p>And add into it the desired translation which in our Gmail examples case will be</p>
<pre><code>root:username@gmail.com:smtp.gmail.com:587
mainuser:username@gmail.com:smtp.gmail.com:587</code></pre>
<p>From now on, the machine will Email when requested through command line or script.</p>
<p>Check setup by creating the a script to send an e-mail to yourself</p>
<pre><code>nano send-alert.sh</code></pre>
<pre><code>#!/bin/sh
 
MAILFILE=/tmp/email_alert.txt
 
echo &quot;Subject: RosettaHUB job completed!&quot; &gt; $MAILFILE
echo &quot;To: mw283@cam.ac.uk&quot; &gt;&gt; $MAILFILE
echo &quot;From: from_who@from_where.com&quot; &gt;&gt; $MAILFILE
 
echo &quot;&quot; &gt;&gt; $MAILFILE
echo &quot;Test sent on $(date &#39;+%Y/%m/%d at %H:%M:%S&#39;).&quot; &gt;&gt; $MAILFILE
echo &quot;&quot; &gt;&gt; $MAILFILE
echo &quot;Have a nice day!&quot; &gt;&gt; $MAILFILE
 
cat $MAILFILE | ssmtp mw283@cam.ac.uk
 
rm $MAILFILE</code></pre>
<p>Make script executable</p>
<pre><code>chmod 700 send-alert.sh</code></pre>
<p>Run script</p>
<pre><code>./send-alert.sh</code></pre>
</div>
<div id="install-r" class="section level2">
<h2><span class="header-section-number">5.6</span> Install R</h2>
<p>Check which version of R is available in the ubuntu repository</p>
<pre><code>apt-cache policy r-base-core</code></pre>
<p>Version 3.2.3 is available, but the latest version of R is 3.5.0. Let’s see if a more recent version of R is available from the official Comprehensive R Archive Network (CRAN) repository.</p>
<p>Open /etc/apt/sources.list and add the following line to the end of the file:</p>
<pre><code>sudo nano /etc/apt/sources.list</code></pre>
<pre><code>deb http://cran.rstudio.com/bin/linux/ubuntu xenial/</code></pre>
<p>Add the key ID for the CRAN network: Ubuntu GPG key:</p>
<pre><code>sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys E084DAB9</code></pre>
<p>Update the repository:</p>
<pre><code>sudo apt update</code></pre>
<p>Install the R binaries:</p>
<pre><code>sudo apt install r-base</code></pre>
<p>R on ubuntu server</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="storage.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="formations.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/bioinformatics-training/intro-machine-learning/edit/master/05-customizing-images.Rmd",
"text": "Edit"
},
"download": ["big-data-cloud-computing.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
